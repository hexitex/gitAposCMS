// const { config } = require("bluebird");


module.exports = {

    extend: 'apostrophe-widgets',
    label: 'Diagram',
    alias: 'diagrams',
    contextualOnly:true,
    beforeConstruct: function (self, options) {
     
        options.addFields = [{
                name: 'diagramName',
                label: 'Diagram ID',
                type: 'string',
                help: 'This is an internal id. It must be unique for the page (NO SPACES and NO NON ALPHA-NUMERIC)',
                required: true,
                def:'621389123768'
        
            },
            {
                name:'svgSource',
                label:'Source - do not edit',
                type:'string',
                def:'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIxNzRweCIgaGVpZ2h0PSIxMzRweCIgdmlld0JveD0iLTAuNSAtMC41IDE3NCAxMzQiIGNvbnRlbnQ9IiZsdDtteGZpbGUgZXRhZz0mcXVvdDs5eGxmRnVHeU1jbjdBUXF3ZldFNSZxdW90OyBhZ2VudD0mcXVvdDs1LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzkxLjAuNDQ3Mi4xMjQgU2FmYXJpLzUzNy4zNiZxdW90OyBtb2RpZmllZD0mcXVvdDsyMDIxLTA2LTI5VDExOjQzOjEwLjQ2MVomcXVvdDsgaG9zdD0mcXVvdDtlbWJlZC5kaWFncmFtcy5uZXQmcXVvdDsgdmVyc2lvbj0mcXVvdDsxNC44LjImcXVvdDsgdHlwZT0mcXVvdDtlbWJlZCZxdW90OyZndDsmbHQ7ZGlhZ3JhbSBpZD0mcXVvdDtyVXV4dm1hbWROWjF6ckxYT2xfNiZxdW90OyBuYW1lPSZxdW90O1BhZ2UtMSZxdW90OyZndDtuVlpiazZwR0VQNDErNWdxTHJwbmVmUUtHRUFYVjhGNUd4Z09vTU1sQWlyOCtueUR1T3ZtSkZWSnJMSVllbWI2OHZYWFRiK29zK3ltbjJtWjJBV0wrSXNpc2R1TE9uOVJGUG50N1JVUElXbnZrcmZ4SUlqUEtSc09mUW0yYVJjTlFtbVFOaW1McW04SDY2TGdkVnArRjRaRm5rZGgvVTFHeitmaSt2M1l6NEovdDFyU09QcEZzQTBwLzFYcXBheE9IbEZJWDNJalN1UGtZVm1XaHAyTVBnNFBnaXFockxnK2lkVEZpem83RjBWOVgyVzNXY1FGZUE5Y0hIa3pIeW1xKzF0T3BEQldKZ3NTcDcvZGxTMy95NVhQRU01Ulh2OXYxYU83bGd2bHpRRE5FRmJkUHJCQ2hLVllwbGtQNnZRU25lc1VVRm8waVBpbXFOSTZMWExzQjBWZEZ4a09jTEV4cGVFcFBoZE56bVlGTDg2OUt2Vm4vM3ZTTWVGcExPN1dSUWtwcmNwN3NuK210d2dPVG51VGs0ZFVla2l3WnJTbUwrcmsvcW9zcTB2OG9reHZHVUtiYlF4SEllMTBGSGkzSnV5a2xCcXVGTTZMaTZVeWxiVmoxVzdIbHpBTEwvWnhjclZuV3NleU1EV05wQTcwY2JmT2s0cDY0L05tdXlxWTRWN1g2ZHNGdDFRckR6c3IwMXJTdnQzV0g2ZXhwZDdQbWVsVUlmNnFvNTdXYkxibXpUb3VvSXVWeEhBTDhlNTBkbXJxQ2FjZUs5aGNTdTBQdXhOM3FMZFgzek50aERPMVBSdko1a3k2V3NkZGJIK0VuVGxmZEhacklwNk43bktTMjVmTjhaYmozeExQa1V3ajFzemV5bWw0UGx1Yi9OWGFGZFl5NnQwcTdCOFBDc2xJNW1hUWRjeFlYYWl5MDh6VXZwS1ArTHFleDlEbFNHR21uY2xXVnFublNsVG9hTTA0MUxVeXlGMGVwakpuMmI1aGhxMloyYklLWm1idm0ybTQ3Y0ViZHdRSUJSL2dsckZLZ3R5cERyN0xmeDhpc3o0bWpiTTlwVGpmTVlWTEJ5WHVJeVRJeGI0a3luaHp5RXArVU4valVIWEhnUTdQTWsxZ213VzZwcTRGWnI1VEhySWJYN2RUaWZpSlpIbEw1SUExMkt1SVI2VDFQM282dmdUWjdodFM5bnpDZ1VKQlBKNVQ0MTBnQ1M2SU15c2UrdnNTUHAzY2JKOHdZOThTWCtoSUpHWk1YcTFXQXh2Q2huVjJFNmlyM0pMZHJTVTdudHN0YnBaQ09DS1d3MngzZE9FZkFTTFVXNVdCenFWb08rU3paT20vWUNZWXR0NXFJK3pYd1BnSkViY00xU2x3UGIyYU9xbUlILzh3OVRzS2xzZGhVZTZBaGd6c0U1THQ0b01DQlBSOUM4VCtZTDRqVVkrTUxjKzVDSVNDL1AzVk5QWk5xQ3d6c3AwZTRTMVFOWDg4VUZxbms1dHpUSzdSdklxcExqS1VTRUlXR3JCcFRCT0NXSUlzckptdW9Vb21pcE5QUjdCVEgveFZUcjBScW1tZnNYa1IyNzM4S1hvd2oxY0VMRG1BL3haeUdtVzhJVjBSSDBSOXdWdkxXMTJFVmJDcFlUTzVvMzdKWWVINk4zbi84bnIyZHhhSXpydFF2eVhSUnhHaldrWEZjbWl2QXNVNVExc1dLR1BwN3NIdUZWWFg5ckdCa2NDbUp0bXlSdDJNWWNVazNnMU1kTXVEc3NBKzhOTzFGaDRkd2FLcitFUFhvUHRSZTRoN094SzRYd09GOXptd3ZMMGl2QTFGcEtoSDdLa1V6RUN0d2NmbGtjREhRTlFQb2hON1lOZko4bGw3OENmSXRlQ0ZuQVJBeFR5TzN1N0lQTVg1SGFuVzhhY2o4emllZzNsSEN0U0Nkcm9FRnBKMXZGNzZzL1BSMnlFM1k2dDdQTWM3NUxneDBXK1FOL2cwZGZCUGd1dzlmbGRYZ3RYY05QaUYrV1ljcUt3eEY4RENnMitlOUdZcHdCdysvZnI4cGJKRmhneVhSOFo3SEtHenJPZUhvWXVGMzdyVUExVWg2elBra1NUd2VCVWgwcTIrcjFEWFlMS1RmTzdmTXlocVdHUVFPbnNiTlRyU2tTSlQ2T1hJcEh0Q0JhV2JrNE5NT1dlY3VaaUwvWW42NzQyVmpwck5UT3U1dFFGQ29jcEtwanVGV0pOT1JCTDJuanNxOWQwakJYYjR1cUFyTEdYcXJ6aFpQS3ArMy8zelYwUGI3Vkx0WTM4S2IvWld5NGkzbEJqdW10SitCRzZnQm5tSzZFdG1uTkkrSjlzcCt2QVNjb0docEpuNXZiOEcraEs1aWEvV1RKSi8zNXB4cE45UWc5VXJSZGNpeDZHZkdQWm5sMExPRTZLaUYvdm9Wa0FOdWJrY1dpMDcrQXRFU1hKd2NvU08yWUk3OThyeXAyMmdyQ3JSUjRDdUpHcVorT2lPWEV0aHU2SDNPaDV5Q005SHVBbVdPRVdnbXVoT2NvbXVVQkY0OXN6SXZ0OGFZQ1E2SDlieXZjK2VQbnZ1aHBPUytBdzllM29LbEgwbjJONnoyMGYxcUNzSkZTa0gralhleWNSQWxUYjJ4L1hTMjU2TDNDeUVSK0lyL3ZWTnVYL1RzY0s4OEMrSHBHR1lFbU5KZEhzYUVZZWhTWStLTEtyUExZNE11K3JyTVA4TkE3RDZtQWV2WCtPay9FTzl5NUxuVVZJZGhIUVlZZU5QM1Y5akdoYkRwUFo0L1Jvbys3Mm5zVnhkL0FrPSZsdDsvZGlhZ3JhbSZndDsmbHQ7L214ZmlsZSZndDsiPjxkZWZzLz48Zz48aW1hZ2UgeD0iLTAuNSIgeT0iLTAuNSIgd2lkdGg9IjE3MyIgaGVpZ2h0PSIxMzMiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCMlpYSnphVzl1UFNJeExqRWlJSGRwWkhSb1BTSXhOek1pSUdobGFXZG9kRDBpTVRNeklpQjJhV1YzUW05NFBTSXRNQzQxSUMwd0xqVWdNVGN6SURFek15SStQR1JsWm5NdlBqeG5Qanh5WldOMElIZzlJakVpSUhrOUlqRWlJSGRwWkhSb1BTSXhOekFpSUdobGFXZG9kRDBpTVRNd0lpQm1hV3hzUFNJalkyWm1abVJtSWlCemRISnZhMlU5SWlNd1pUZ3dPRGdpSUhOMGNtOXJaUzEzYVdSMGFEMGlNeUlnY0c5cGJuUmxjaTFsZG1WdWRITTlJbUZzYkNJdlBqeG5JSFJ5WVc1elptOXliVDBpZEhKaGJuTnNZWFJsS0Mwd0xqVWdMVEF1TlNraVBqeHpkMmwwWTJnK1BHWnZjbVZwWjI1UFltcGxZM1FnYzNSNWJHVTlJbTkyWlhKbWJHOTNPaUIyYVhOcFlteGxPeUIwWlhoMExXRnNhV2R1T2lCc1pXWjBPeUlnY0c5cGJuUmxjaTFsZG1WdWRITTlJbTV2Ym1VaUlIZHBaSFJvUFNJeE1EQWxJaUJvWldsbmFIUTlJakV3TUNVaUlISmxjWFZwY21Wa1JtVmhkSFZ5WlhNOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkwxUlNMMU5XUnpFeEwyWmxZWFIxY21ValJYaDBaVzV6YVdKcGJHbDBlU0krUEdScGRpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YUhSdGJDSWdjM1I1YkdVOUltUnBjM0JzWVhrNklHWnNaWGc3SUdGc2FXZHVMV2wwWlcxek9pQjFibk5oWm1VZ1kyVnVkR1Z5T3lCcWRYTjBhV1o1TFdOdmJuUmxiblE2SUhWdWMyRm1aU0JqWlc1MFpYSTdJSGRwWkhSb09pQXhOamh3ZURzZ2FHVnBaMmgwT2lBeGNIZzdJSEJoWkdScGJtY3RkRzl3T2lBMk5uQjRPeUJ0WVhKbmFXNHRiR1ZtZERvZ01uQjRPeUkrUEdScGRpQnpkSGxzWlQwaVltOTRMWE5wZW1sdVp6b2dZbTl5WkdWeUxXSnZlRHNnWm05dWRDMXphWHBsT2lBd095QjBaWGgwTFdGc2FXZHVPaUJqWlc1MFpYSTdJQ0krUEdScGRpQnpkSGxzWlQwaVpHbHpjR3hoZVRvZ2FXNXNhVzVsTFdKc2IyTnJPeUJtYjI1MExYTnBlbVU2SURFeWNIZzdJR1p2Ym5RdFptRnRhV3g1T2lCSVpXeDJaWFJwWTJFN0lHTnZiRzl5T2lBak1EQXdNREF3T3lCc2FXNWxMV2hsYVdkb2REb2dNUzR5T3lCd2IybHVkR1Z5TFdWMlpXNTBjem9nWVd4c095QjNhR2wwWlMxemNHRmpaVG9nYm05eWJXRnNPeUIzYjNKa0xYZHlZWEE2SUc1dmNtMWhiRHNnSWo0OFptOXVkQ0J6ZEhsc1pUMGlabTl1ZEMxemFYcGxPaUF5TlhCNElqNURiR2xqYXlCMGJ5QkZaR2wwTGp3dlptOXVkRDQ4WW5JZ0x6NDhZbklnTHo1VWFHVnVJR1JsYkdWMFpTQk5aU0JoYm1RZ1EzSmxZWFJsSUhsdmRYSWdiM2R1SUVScFlXZHlZVzA4TDJScGRqNDhMMlJwZGo0OEwyUnBkajQ4TDJadmNtVnBaMjVQWW1wbFkzUStQSFJsZUhRZ2VEMGlPRFlpSUhrOUlqY3dJaUJtYVd4c1BTSWpNREF3TURBd0lpQm1iMjUwTFdaaGJXbHNlVDBpU0dWc2RtVjBhV05oSWlCbWIyNTBMWE5wZW1VOUlqRXljSGdpSUhSbGVIUXRZVzVqYUc5eVBTSnRhV1JrYkdVaVBrTnNhV05ySUhSdklFVmthWFF1TGk0dVBDOTBaWGgwUGp3dmMzZHBkR05vUGp3dlp6NDhMMmMrUEhOM2FYUmphRDQ4WnlCeVpYRjFhWEpsWkVabFlYUjFjbVZ6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk5VVVpOVRWa2N4TVM5bVpXRjBkWEpsSTBWNGRHVnVjMmxpYVd4cGRIa2lMejQ4WVNCMGNtRnVjMlp2Y20wOUluUnlZVzV6YkdGMFpTZ3dMQzAxS1NJZ2VHeHBibXM2YUhKbFpqMGlhSFIwY0hNNkx5OTNkM2N1WkdsaFozSmhiWE11Ym1WMEwyUnZZeTltWVhFdmMzWm5MV1Y0Y0c5eWRDMTBaWGgwTFhCeWIySnNaVzF6SWlCMFlYSm5aWFE5SWw5aWJHRnVheUkrUEhSbGVIUWdkR1Y0ZEMxaGJtTm9iM0k5SW0xcFpHUnNaU0lnWm05dWRDMXphWHBsUFNJeE1IQjRJaUI0UFNJMU1DVWlJSGs5SWpFd01DVWlQbFpwWlhkbGNpQmtiMlZ6SUc1dmRDQnpkWEJ3YjNKMElHWjFiR3dnVTFaSElERXVNVHd2ZEdWNGRENDhMMkUrUEM5emQybDBZMmcrUEM5emRtYysiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiLz48L2c+PC9zdmc+',
                required:true
            }
        ].concat(options.addFields || []);

   
        options.arrangeFields = options.arrangeFields || [

            {
                name: 'brief',
                label: 'Settings',
                fields: ['diagramName','width','height']
            },

        ];
      
    },
  
    construct: function (self, options) {
     
        self.pushAsset('script', 'initDiagram', {
            when: 'always'
        });
    }

};